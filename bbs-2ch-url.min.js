!function(a){"use strict";function b(a){var b=[],c=!1;return a.split(",").forEach(function(a){for(var d,e=a.split("-",2),f=0,g=e.length;g>f;f++)if(d=e[f].match(/^(\D*)(\d+)(\D*)/)){var h=d[1]+d[3];e[f]=-1!==h.indexOf("l")?-d[2]:d[2]>1?+d[2]:0/0,-1!==h.indexOf("n")&&(c=!0)}else e[f]=0/0;e[0]>0&&e[0]--,1===e.length?isNaN(e[0])||(e[0]>0?(b.push([e[0],e[0]+1]),c=!0):b.push([e[0]])):2===e.length&&(isNaN(e[0])?isNaN(e[1])||(b.push([0,e[1]]),c=!0):b.push(isNaN(e[1])?[e[0]]:[e[0],e[1]]))}),b.length>0&&!c&&b.unshift([0,1]),b}function c(a){var c,d=null;if(!a)return null;if("string"==typeof a){if(!(c=a.match(/^h?ttp\:\/\/([^\/]+)(\/.*)/)))return null;a={host:c[1],path:c[2],href:a}}else if(!a.host||!a.path)return null;return"bg20.2ch.net"===a.host||"bg30.2ch.net"===a.host?(c=a.path.match(/^\/test\/r\.so\/([^\/]+)\/([^\/]+)\/(\d+)/))?d={type:"raw",cache:a.host,host:c[1],bbs:c[2],key:+c[3]}:(c=a.path.match(/^\/test\/p\.so\/([^\/]+)\/([^\/]+)/))&&(d={type:"raw",cache:a.host,host:c[1],bbs:c[2]}):(c=a.path.match(/^\/test\/read\.cgi\/([^\/]+)\/(\d+)\/?(.*)$/))?(d={type:"html",host:a.host,bbs:c[1],key:+c[2]},c[3]&&(d.range=c[3],d.rangeSlices=b(c[3]))):(c=a.path.match(/^\/([^\/]+)\/dat\/(\d+).dat/))?d={type:"raw",host:a.host,bbs:c[1],key:+c[2]}:(c=a.path.match(/^\/([^\/]+)\/?(subject.txt)?$/))&&(d={type:c[2]?"raw":"html",host:a.host,bbs:c[1]}),d}function d(a,b){var c;if(!a||!a.host||!a.bbs)return null;if("html"===a.type)c={host:a.host,path:a.key?"/test/read.cgi/"+a.bbs+"/"+a.key+"/"+(a.range||""):"/"+a.bbs+"/"};else{if("raw"!==a.type&&"undefined"!=typeof a.type)return null;c=a.cache?{host:a.cache,path:a.key?"/test/r.so/"+a.host+"/"+a.bbs+"/"+a.key+"/":"/test/p.so/"+a.host+"/"+a.bbs+"/"}:{host:a.host,path:a.key?"/"+a.bbs+"/dat/"+a.key+".dat":"/"+a.bbs+"/subject.txt"}}return c.href="http://"+c.host+c.path,b?c:c.href}a.bbs2ch=a.bbs2ch||{},a.bbs2ch.url={parseRangeString:b,parse:c,format:d},"undefined"!=typeof module&&(module.exports=a.bbs2ch.url)}(this.self||global);