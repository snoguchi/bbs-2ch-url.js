(function(d){function h(a){var c=[],b=!1;a.split(",").forEach(function(a){a=a.split("-",2);for(var e,f=0,d=a.length;f<d;f++)if(e=a[f].match(/^(\D*)(\d+)(\D*)/)){var g=e[1]+e[3];-1!==g.indexOf("l")?a[f]=-e[2]:a[f]=1<e[2]?+e[2]:NaN;-1!==g.indexOf("n")&&(b=!0)}else a[f]=NaN;0<a[0]&&a[0]--;1===a.length?isNaN(a[0])||(0<a[0]?(c.push([a[0],a[0]+1]),b=!0):c.push([a[0]])):2===a.length&&(isNaN(a[0])?isNaN(a[1])||(c.push([0,a[1]]),b=!0):isNaN(a[1])?c.push([a[0]]):c.push([a[0],a[1]]))});0<c.length&&!b&&c.unshift([0,
1]);return c}function k(a){var c=null,b;b=a;a={};if("string"===typeof b){if(b=b.match(/^h?ttp\:\/\/([^\/]+)(\/.*)/))a.host=b[1],a.path=b[2]}else a.host=b.host||b.hostname,a.path=b.path||b.pathname;if(!a.host||!a.path)return null;if("bg.2ch.net"===a.host)if(b=a.path.match(/^\/test\/r\.so\/([^\/]+)\/([^\/]+)\/(\d+)/))c={host:b[1],board:b[2],thread:+b[3]};else{if(b=a.path.match(/^\/test\/p\.so\/([^\/]+)\/([^\/]+)/))c={host:b[1],board:b[2]}}else if(b=a.path.match(/^\/test\/read\.cgi\/([^\/]+)\/(\d+)\/?(.*)$/))c=
{host:a.host,board:b[1],thread:+b[2]},b[3]&&(c.range=b[3],c.rangeSlices=h(b[3]));else if(b=a.path.match(/^\/([^\/]+)\/dat\/(\d+).dat/))c={host:a.host,board:b[1],thread:+b[2]};else if(b=a.path.match(/^\/([^\/]+)\/?(subject.txt)?$/))c={host:a.host,board:b[1]};return c}function g(a,c){var b=null;"string"===typeof a&&(a=k(a));if(!a.host||!a.board)return null;switch(c){case "board":b={host:a.host,path:"/"+a.board+"/"};break;case "subject":b={host:a.host,path:"/"+a.board+"/subject.txt"};break;case "subject:bg":b=
{host:"bg20.2ch.net",path:"/test/p.so/"+a.host+"/"+a.board+"/"};break;case "thread":a.thread&&(b={host:a.host,path:"/test/read.cgi/"+a.board+"/"+a.thread+"/"+(a.range||"")});break;case "dat":a.thread&&(b={host:a.host,path:"/"+a.board+"/dat/"+a.thread+".dat"});break;case "dat:bg":a.thread&&(b={host:"bg20.2ch.net",path:"/test/r.so/"+a.host+"/"+a.board+"/"+a.thread+"/"});break;default:b=g(a,a.thread?"dat":"subject")}return b}d.bbs2ch=d.bbs2ch||{};d.bbs2ch.url={parseRangeString:h,parse:k,convert:g,format:function(a,
c){var b=g(a,c);return b?"http://"+b.host+b.path:""}};"undefined"!==typeof module&&(module.exports=d.bbs2ch.url)})(this.self||global);
