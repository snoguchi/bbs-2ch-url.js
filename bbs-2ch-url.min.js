(function(d){function g(a){var c=[],b=!1;a.split(",").forEach(function(a){a=a.split("-",2);for(var e,f=0,d=a.length;f<d;f++)if(e=a[f].match(/^(\D*)(\d+)(\D*)/)){var g=e[1]+e[3];-1!==g.indexOf("l")?a[f]=-e[2]:a[f]=1<e[2]?+e[2]:NaN;-1!==g.indexOf("n")&&(b=!0)}else a[f]=NaN;0<a[0]&&a[0]--;1===a.length?isNaN(a[0])||(0<a[0]?(c.push([a[0],a[0]+1]),b=!0):c.push([a[0]])):2===a.length&&(isNaN(a[0])?isNaN(a[1])||(c.push([0,a[1]]),b=!0):isNaN(a[1])?c.push([a[0]]):c.push([a[0],a[1]]))});0<c.length&&!b&&c.unshift([0,
1]);return c}d.bbs2ch=d.bbs2ch||{};d.bbs2ch.url={parseRangeString:g,parse:function(a){var c=null,b;if(!a)return null;if("string"===typeof a){if(!(b=a.match(/^h?ttp\:\/\/([^\/]+)(\/.*)/)))return null;a={host:b[1],path:b[2],href:a}}else if(!a.host||!a.path)return null;if("bg20.2ch.net"===a.host)if(b=a.path.match(/^\/test\/r\.so\/([^\/]+)\/([^\/]+)\/(\d+)/))c={type:"bg",host:b[1],bbs:b[2],key:+b[3]};else{if(b=a.path.match(/^\/test\/p\.so\/([^\/]+)\/([^\/]+)/))c={type:"bg",host:b[1],bbs:b[2]}}else if(b=
a.path.match(/^\/test\/read\.cgi\/([^\/]+)\/(\d+)\/?(.*)$/))c={type:"html",host:a.host,bbs:b[1],key:+b[2]},b[3]&&(c.range=b[3],c.rangeSlices=g(b[3]));else if(b=a.path.match(/^\/([^\/]+)\/dat\/(\d+).dat/))c={type:"raw",host:a.host,bbs:b[1],key:+b[2]};else if(b=a.path.match(/^\/([^\/]+)\/?(subject.txt)?$/))c={type:b[2]?"raw":"html",host:a.host,bbs:b[1]};return c},format:function(a,c){var b;if(!a||!a.host||!a.bbs)return null;switch(a.type){case "bg":b={host:"bg20.2ch.net",path:a.key?"/test/r.so/"+a.host+
"/"+a.bbs+"/"+a.key+"/":"/test/p.so/"+a.host+"/"+a.bbs+"/"};break;case "html":b={host:a.host,path:a.key?"/test/read.cgi/"+a.bbs+"/"+a.key+"/"+(a.range||""):"/"+a.bbs+"/"};break;case "raw":case void 0:b={host:a.host,path:a.key?"/"+a.bbs+"/dat/"+a.key+".dat":"/"+a.bbs+"/subject.txt"};break;default:return null}b.href="http://"+b.host+b.path;return c?b:b.href}};"undefined"!==typeof module&&(module.exports=d.bbs2ch.url)})(this.self||global);
