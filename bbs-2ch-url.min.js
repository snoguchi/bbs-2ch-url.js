(function(g){function h(a){var e=[],d=!1;a.split(",").forEach(function(b){b=b.split("-",2);for(var a,c=0,g=b.length;c<g;c++)if(a=b[c].match(/^(\D*)(\d+)(\D*)/)){var h=a[1]+a[3];-1!==h.indexOf("l")?b[c]=-a[2]:b[c]=1<a[2]?+a[2]:NaN;-1!==h.indexOf("n")&&(d=!0)}else b[c]=NaN;0<b[0]&&b[0]--;1===b.length?isNaN(b[0])||(0<b[0]?(e.push([b[0],b[0]+1]),d=!0):e.push([b[0]])):2===b.length&&(isNaN(b[0])?isNaN(b[1])||(e.push([0,b[1]]),d=!0):isNaN(b[1])?e.push([b[0]]):e.push([b[0],b[1]]))});0<e.length&&!d&&e.unshift([0,
1]);return e}function k(a,e){var d=null;if(!a.host||!a.board)return null;switch(e){case "board":d={host:a.host,path:"/"+a.board+"/"};break;case "subject":d={host:a.host,path:"/"+a.board+"/subject.txt"};break;case "subject:bg":d={host:"bg20.2ch.net",path:"/test/p.so/"+a.host+"/"+a.board+"/"};break;case "thread":a.thread&&(d={host:a.host,path:"/test/read.cgi/"+a.board+"/"+a.thread+"/"+(a.range||"")});break;case "dat":a.thread&&(d={host:a.host,path:"/"+a.board+"/dat/"+a.thread+".dat"});break;case "dat:bg":a.thread&&
(d={host:"bg20.2ch.net",path:"/test/r.so/"+a.host+"/"+a.board+"/"+a.thread+"/"});break;default:d=k(a,a.thread?"dat":"subject")}return d}g.bbs2ch=g.bbs2ch||{};g.bbs2ch.url={parseRangeString:h,parse:function(a,e){var d,b;if(b="string"===typeof a){b=null;var f;if(f=a.match(/^h?ttp\:\/\/([^\/]+)(\/.*)/))b={host:f[1],path:f[2]};b=!(a=b)}if(b)return null;if(!(b=a.bbs)){b=a;f=null;var c;if("bg20.2ch.net"===b.host)if(c=b.path.match(/^\/test\/r\.so\/([^\/]+)\/([^\/]+)\/(\d+)/))f={host:c[1],board:c[2],thread:+c[3]};
else{if(c=b.path.match(/^\/test\/p\.so\/([^\/]+)\/([^\/]+)/))f={host:c[1],board:c[2]}}else if(c=b.path.match(/^\/test\/read\.cgi\/([^\/]+)\/(\d+)\/?(.*)$/))f={host:b.host,board:c[1],thread:+c[2]},c[3]&&(f.range=c[3],f.rangeSlices=h(c[3]));else if(c=b.path.match(/^\/([^\/]+)\/dat\/(\d+).dat/))f={host:b.host,board:c[1],thread:+c[2]};else if(c=b.path.match(/^\/([^\/]+)\/?(subject.txt)?$/))f={host:b.host,board:c[1]};b=f}if(!(d=b)||e&&!(a=k(d,e)))return null;a.bbs=d;a.href="http://"+a.host+a.path;return a}};
"undefined"!==typeof module&&(module.exports=g.bbs2ch.url)})(this.self||global);
